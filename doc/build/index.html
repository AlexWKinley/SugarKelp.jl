<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Index · Kelp Documentation</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">Kelp Documentation</a></span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href="index.html">Index</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Contents"><span>Contents</span></a></li><li class="toplevel"><a class="tocitem" href="#Getting-Started"><span>Getting Started</span></a></li><li><a class="tocitem" href="#Current-dependencies"><span>Current dependencies</span></a></li><li><a class="tocitem" href="#Running-a-model"><span>Running a model</span></a></li><li class="toplevel"><a class="tocitem" href="#Model-Verification"><span>Model Verification</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="index.html">Index</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Index</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jagoosw/Kelp" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Kelp.jl"><a class="docs-heading-anchor" href="#Kelp.jl">Kelp.jl</a><a id="Kelp.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Kelp.jl" title="Permalink"></a></h1><p><a href="https://github.com/jagoosw/Kelp.jl">Kelp.jl</a> is an implementation of the sugar kelp growth model from <a href="https://link.springer.com/article/10.1007/s10811-011-9695-y">Broch and Slagstad model of the growth and composition of <em>Saccharina latissima</em>  Kelp</a>.</p><h1 id="Contents"><a class="docs-heading-anchor" href="#Contents">Contents</a><a id="Contents-1"></a><a class="docs-heading-anchor-permalink" href="#Contents" title="Permalink"></a></h1><ul><li><a href="functions.html#Function-Documentation">Function Documentation</a></li></ul><h1 id="Getting-Started"><a class="docs-heading-anchor" href="#Getting-Started">Getting Started</a><a id="Getting-Started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-Started" title="Permalink"></a></h1><h2 id="Current-dependencies"><a class="docs-heading-anchor" href="#Current-dependencies">Current dependencies</a><a id="Current-dependencies-1"></a><a class="docs-heading-anchor-permalink" href="#Current-dependencies" title="Permalink"></a></h2><ul><li>RecursiveArrayTools</li><li>DiffEqBase</li><li>OrdinaryDiffEq</li><li>Roots</li><li>Interpolations</li><li>DataFrames</li><li>Plots</li><li>Dates</li><li>Measures</li><li>CSV</li><li>LaTeXStrings</li></ul><p>Install them all with:</p><p><code>import Pkg; Pkg.add([&quot;RecursiveArrayTools&quot;, &quot;DiffEqBase&quot;, &quot;OrdinaryDiffEq&quot;, &quot;Roots&quot;, &quot;Interpolations&quot;, &quot;DataFrames&quot;, &quot;Plots&quot;, &quot;Dates&quot;, &quot;Measures&quot;, &quot;CSV&quot;, &quot;LaTeXStrings&quot;])</code></p><p>You can possibly also be able to run <code>import Pkg</code> then <code>[dev Kelp</code> from the directory below this repository. </p><h2 id="Running-a-model"><a class="docs-heading-anchor" href="#Running-a-model">Running a model</a><a id="Running-a-model-1"></a><a class="docs-heading-anchor-permalink" href="#Running-a-model" title="Permalink"></a></h2><pre><code class="nohighlight hljs">include(&quot;Kelp/src/Kelp.jl&quot;)</code></pre><p>Define the required parameters, in this example the parameters &quot;provided&quot; in Broch and Slagstad 2012. Firstly the constants:</p><pre><code class="nohighlight hljs">offset = 4*31+28+30*2.0
t_i = offset+12
nd = 365+16
lat = 60.257</code></pre><p>The first, <code>offset</code>, is used here to align the environmental data with the start of the year. We then have <code>t_i</code> which is the start time in days since January 1st (of whatever year the environmental data starts). <code>n_d</code> is the number of days to run for and <code>lat</code> is latitude (used to calculate the length of the day). Next load the input data:</p><pre><code class="nohighlight hljs">using CSV

temp_file=CSV.read(&quot;examples/bs2012/temp.csv&quot;,DataFrame); sort!(temp_file); temp_t=temp_file.day; temp=temp_file.temp
no3_file=CSV.read(&quot;examples/bs2012/no3.csv&quot;,DataFrame); sort!(no3_file); no3_t=no3_file.day; no3=no3_file.no3
irr_file=CSV.read(&quot;examples/bs2012/irr.csv&quot;,DataFrame); sort!(irr_file); irr_t=irr_file.day; irr=irr_file.irr
temp_t .+= offset; no3_t .+= offset; irr_t .+= offset</code></pre><p>The model takes interpolation objects for the environmental parameters (irradiance, temperature and nitrate concentration) so that the dates time steps vs the models can be arbitrary. They also need to be in units <code>mol photons per square meter per day</code>, <code>degrees centigrade</code> and <code>millimoles of Nitrate per cubic meter</code>. Generate the interpolations like this:</p><pre><code class="nohighlight hljs">temp_arr = Interpolations.LinearInterpolation(temp_t, temp, extrapolation_bc=Flat())
no3_arr = Interpolations.LinearInterpolation(no3_t, no3, extrapolation_bc=Flat())
irr_arr = Interpolations.LinearInterpolation(irr_t, irr, extrapolation_bc=Flat())</code></pre><p>You may not want the boundaries to extrapolate.</p><p>The current speed can also be time varying but to make it constant use:</p><pre><code class="nohighlight hljs">u = 0.15
u_arr = Interpolations.LinearInterpolation([t_i:t_i + nd;], fill(u, Int(nd + 1)))</code></pre><p>Finally, define the initial conditions (<code>a_0</code>=initial area in <span>$dm^2$</span>, <code>n_0</code>=initial fraction of nitrogen reseve and <code>c_0</code>=initial fraction carbon reserve) and run the model:</p><pre><code class="nohighlight hljs">a_0 = 30;n_0 = 0.01;c_0 = 0.6

solution, results = Kelp.solvekelp(t_i, nd, u_arr, temp_arr, irr_arr, no3_arr, lat, a_0, n_0, c_0, &quot;../src/parameters/origional.jl&quot;)</code></pre><p>Here the final parameter <code>&quot;../src/parameters/origional.jl&quot;</code> is specifying to use the model parameters from the 2012 paper, alternatively you can use <code>&quot;../src/parameters/2013.jl&quot;</code>. You can also use the adjusted respiration model from the 2013 paper by adding a parameter with the value of <code>2</code>.</p><p>The following code produces a plot of all the input and output parameters (as shown below):</p><pre><code class="nohighlight hljs">using Plots
pyplot()
l = @layout [[a{0.25h};b{0.25h};c{0.5h}] grid(2, 1)]
plot(layout=l)

plot!(temp_t,temp,sp=1,ylabel=L&quot;Temperature/$^o$C&quot;,xlabel=&quot;Month&quot;,legend=false,label=&quot;Temperature&quot;)
plt = twinx()
plot!([no3_t[1],no3_t[1]],[no3[1]no3[1]],sp=6,label=&quot;Temperature&quot;)
plot!(no3_t,no3,sp=6,ylabel=L&quot;Nitrate/$\mu$ mol / L&quot;,legend=:right,label=&quot;Nitrate&quot;)
plot!(irr_t,irr,sp=2,ylabel=L&quot;Irradiance/mol photons/m$^2$/day&quot;,legend=false,xlabel=&quot;Month&quot;)

# structural to dry weight conversion (paper plots g/g dry weight where as g/g structural weight is used in calculations)
n_factor = (results.nitrogen .- N_min) .* K_N
c_factor = (results.carbon .- C_min) .* K_C
w_factor = 1 .+ n_factor .+ c_factor .+ C_min .+ N_min

plot!(results.time,results.area,sp=3,xlabel=&quot;Month&quot;, ylabel=L&quot;Frond Area/dm$^2$&quot;,ylim=(29, 46),label=&quot;Model&quot;,legend=false)

plot!(results.time,(results.nitrogen .+ N_struct) ./ w_factor,sp=4, xlabel=&quot;Month&quot;, ylabel=&quot;Nitrogen reserve/gN/g dw&quot;,label=&quot;Model&quot;)

plot!(results.time,(results.carbon .+ C_struct) ./ w_factor,sp=5, xlabel=&quot;Month&quot;, ylabel=&quot;Carbon reserve/gC/g dw&quot;,label=&quot;Model&quot;,legend=false)

t_ticks = []
val_ticks = []
for day in t_i:t_i + nd
    date = Date(1981, 1, 1) + Dates.Day(day)
    if Dates.format(date, &quot;d&quot;) == &quot;1&quot;
        push!(t_ticks, day)
        push!(val_ticks, Dates.format(date, &quot;U&quot;)[1])
    end
end

plot!(xticks=(t_ticks, val_ticks))
display(display(plot!()))</code></pre><p><img src="img/paper.png" alt="Plot showing the inputs (irradiance, temperature, nitrate concentration) and model outputs (area, nitrogen reserve and carbon reserve)."/> </p><h1 id="Model-Verification"><a class="docs-heading-anchor" href="#Model-Verification">Model Verification</a><a id="Model-Verification-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Verification" title="Permalink"></a></h1><p>The models outputs compared with figure 3 in Broch and Slagstad 2012 are shown below: <img src="img/paper_comparison.png" alt="B&amp;S2012 Figure 3 equivalent."/> The discrepancies may be down to the inaccuracy of reporting of the model parameters or the difficulty extracting the input data from the paper. </p><p>Changes to the parameters from those published are detailed <a href="https://github.com/jagoosw/Kelp/blob/master/changes.pdf">here</a>.</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.4 on <span class="colophon-date" title="Tuesday 10 August 2021 19:43">Tuesday 10 August 2021</span>. Using Julia version 1.6.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
